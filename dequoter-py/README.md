# dequoter-py

A JSON-to-CSV quota generator for Decipher

### prerequisites

Python 3.x (I haven't tested with Python 2 :p)

### usage

From the command line, use:

`python dequoter.py [list of json files separated by spaces]`

On Windows, depending on your Python installation this might not work because the `python` executable may not be in the PATH. You can instead use:

`py dequoter.py [list of json files separated by spaces]`

Or drag and drop the JSON files directly onto the included `dequote.bat` file. :)

> Please note: you can now use JSON generated by [dequoter-web](https://github.com/slendersnax/dequoted/tree/main/dequoter-web)

The CSV file will be generated in the same folder as the JSON file.

<details>
<summary>The JSON files should have the following format:</summary>

```json
[
	{
		"name" : "gender x age quota",
		"cells": "1",
		"limit":"inf",
		"markers": [
			{"label":"gender","separator":"_","start":"1","end":"3","step":"1"},
			{"label":"age","separator":"_","start":"2","end":"6","step":"1"}
		]
	},
	{
		"name" : "region quota",
		"cells": "1",
		"limit":"inf",
		"markers": [
			["region_1", "region_2", "region_49"]
		]
	},
	{
		"name" : "country x csp x cell quota",
		"cells": "2",
		"limit":"inf",
		"markers": [
			{"label":"country","separator":"_","start":"1","end":"4","step":"1"},
			{"label":"csp","separator":"_","start":"0","end":"9","step":"3"},
			["cell_1", "cell_3", "cell_6"]
		]
	}
]

```
</details>

Where:

- name: the name of the quota table
- cells: the number of cells to be selected by the Least Fill
- limit: the limit set for all the quotas
- markers: an array of arrays and objects
	- the arrays are always arrays of strings
	- the objects are used to generate arrays of strings, where each string will be built as follows:
		- `label` + `separator` + `current index`
		- e.g. `{"label":"gender","separator":"_","start":"1","end":"3","step":"1"}` will generate `["gender_1", "gender_2", "gender_3"]`
		- yes, it is a bit verbose for these small cases :p

<details>
<summary>For example, the JSON code above will generate the following CSV:</summary>

```csv
# cells:1 = gender x age quota,#
gender_1,age_2,inf
gender_1,age_3,inf
gender_1,age_4,inf
gender_1,age_5,inf
gender_1,age_6,inf
gender_2,age_2,inf
gender_2,age_3,inf
gender_2,age_4,inf
gender_2,age_5,inf
gender_2,age_6,inf
gender_3,age_2,inf
gender_3,age_3,inf
gender_3,age_4,inf
gender_3,age_5,inf
gender_3,age_6,inf

# cells:1 = region quota
region_1,inf
region_2,inf
region_49,inf

# cells:2 = country x csp x cell quota,#,#
country_1,csp_0,cell_1,inf
country_1,csp_0,cell_3,inf
country_1,csp_0,cell_6,inf
country_1,csp_3,cell_1,inf
country_1,csp_3,cell_3,inf
country_1,csp_3,cell_6,inf
country_1,csp_6,cell_1,inf
country_1,csp_6,cell_3,inf
country_1,csp_6,cell_6,inf
country_1,csp_9,cell_1,inf
country_1,csp_9,cell_3,inf
country_1,csp_9,cell_6,inf
country_2,csp_0,cell_1,inf
country_2,csp_0,cell_3,inf
country_2,csp_0,cell_6,inf
country_2,csp_3,cell_1,inf
country_2,csp_3,cell_3,inf
country_2,csp_3,cell_6,inf
country_2,csp_6,cell_1,inf
country_2,csp_6,cell_3,inf
country_2,csp_6,cell_6,inf
country_2,csp_9,cell_1,inf
country_2,csp_9,cell_3,inf
country_2,csp_9,cell_6,inf
country_3,csp_0,cell_1,inf
country_3,csp_0,cell_3,inf
country_3,csp_0,cell_6,inf
country_3,csp_3,cell_1,inf
country_3,csp_3,cell_3,inf
country_3,csp_3,cell_6,inf
country_3,csp_6,cell_1,inf
country_3,csp_6,cell_3,inf
country_3,csp_6,cell_6,inf
country_3,csp_9,cell_1,inf
country_3,csp_9,cell_3,inf
country_3,csp_9,cell_6,inf
country_4,csp_0,cell_1,inf
country_4,csp_0,cell_3,inf
country_4,csp_0,cell_6,inf
country_4,csp_3,cell_1,inf
country_4,csp_3,cell_3,inf
country_4,csp_3,cell_6,inf
country_4,csp_6,cell_1,inf
country_4,csp_6,cell_3,inf
country_4,csp_6,cell_6,inf
country_4,csp_9,cell_1,inf
country_4,csp_9,cell_3,inf
country_4,csp_9,cell_6,inf
```
</details>

Viewed in LibreOffice Calc (FOSS equivalent of Excel):

![partial testdata result](screenshots/testdata_result.png?)

### q&a

Why JSON to CSV?

JSON is very popular and (I think) easy to understand; CSV because it's easy to generate and because the quota files for Decipher are Excel 2010 (.xls) files - which means that you can just copy the data from the CSV file to the quota file.

### to-do

- [x] ~~test on Python 2.x~~
	- nope, not doing that
- [x] add examples
- [x] create option to make irregular numbering patterns
- [x] ~~add easy-to-run Bash and Batch files~~
	- [x] test on Windows - it works
- [x] make input and output filenames parameters